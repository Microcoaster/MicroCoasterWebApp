<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="env" content="<%= process.env.NODE_ENV || 'production' %>">
  <title><%= title %></title>
  <!-- Bootstrap Grid pour la responsivité -->
  <link rel="stylesheet" href="/css/bootstrap-grid.min.css">
  <!-- CSS global (variables, boutons, modals, toasts, navbar) -->
  <link rel="stylesheet" href="/css/global.css">
  <!-- CSS principal des modules réutilisé pour la cohérence -->
  <link rel="stylesheet" href="/css/modules.css">
  <!-- CSS spécifique au dashboard -->
  <link rel="stylesheet" href="/css/dashboard.css">
  <link rel="shortcut icon" href="/assets/ico/favicon.ico" type="image/x-icon"/>
</head>
<body class="compact">

  <%- include('partials/navbar', { currentPage: 'dashboard' }) %>

  <div class="container-fluid main-content">
    <main class="content">
      <section class="card panels">
        <div class="container-fluid">
          <div class="row">
            <div class="col-12">
              <header class="page-header">
                <h1 class="page-title">Dashboard</h1>
              </header>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="dashboard-grid">
                
                <!-- Carte de bienvenue -->
                <div class="dashboard-card welcome-card">
                  <h2>Welcome back, <%= user.nickname || 'User' %>!</h2>
                  <p>Manage your MicroCoaster modules and monitor your theme park systems.</p>
                  
                  <div class="quick-actions">
                    <a href="/modules" class="quick-action-btn">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="9" cy="9" r="2"/>
                        <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                      </svg>
                      View Modules
                    </a>
                    <button class="quick-action-btn" onclick="addNewModule()">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="16"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                      </svg>
                      Add Module
                    </button>
                  </div>
                </div>

                <!-- Statistiques -->
                <div class="dashboard-card">
                  <h3>
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                      <circle cx="9" cy="9" r="2"/>
                      <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                    </svg>
                    Total Modules
                  </h3>
                  <div class="dashboard-stat"><%= stats.totalModules %></div>
                  <p class="dashboard-description">Modules claimed on your account</p>
                </div>

                <div class="dashboard-card">
                  <h3>
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    Online Modules
                  </h3>
                  <div class="dashboard-stat online"><%= stats.onlineModules %></div>
                  <p class="dashboard-description">Currently connected and active</p>
                </div>

                <div class="dashboard-card">
                  <h3>
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="12"/>
                      <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    Offline Modules
                  </h3>
                  <div class="dashboard-stat offline"><%= stats.offlineModules %></div>
                  <p class="dashboard-description">Disconnected or unavailable</p>
                </div>

                <!-- Types de modules -->
                <div class="dashboard-card">
                  <h3>
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 2L2 7v10c0 5.55 3.84 10 9 10s9-4.45 9-10V7L12 2z"/>
                      <polyline points="8,12 12,16 16,12"/>
                    </svg>
                    Module Types
                  </h3>
                  <div class="module-types">
                    <% Object.entries(stats.moduleTypes).forEach(([type, count]) => { %>
                      <div class="type-row">
                        <span class="type-name"><%= type %></span>
                        <span class="type-count"><%= count %></span>
                      </div>
                    <% }); %>
                  </div>
                </div>

                <!-- Activité récente -->
                <div class="dashboard-card">
                  <h3>
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
                    </svg>
                    System Status
                  </h3>
                  <div class="system-status">
                    <div class="status-item">
                      <div class="status-indicator online"></div>
                      <span class="status-text">WebSocket Connected</span>
                    </div>
                    <div class="status-item">
                      <div class="status-indicator online"></div>
                      <span class="status-text">Database Connected</span>
                    </div>
                    <p class="dashboard-description">All systems operational</p>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/global.js"></script>
  <script src="/js/dashboard.js"></script>

</body>
</html>